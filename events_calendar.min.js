function $(){var c=new Array();for(var b=0;b<arguments.length;b++){var a=arguments[b];if(typeof a=="string"){a=document.getElementById(a)}if(arguments.length==1){return a}c.push(a)}return c}Element.prototype.createChild=function(a,c,d){var b=document.createElement(a);this.appendChild(b);if(c){for(key in c){b.setAttribute(key,c[key])}}if(d){b.innerHTML=d}return b};Element.prototype.insertChild=function(a,c,d){var b=document.createElement(a);this.insertBefore(b,this.childNodes[0]);if(c){for(key in c){b.setAttribute(key,c[key])}}if(d){b.innerHTML=d}return b};Element.prototype.hasClassName=function(b){return new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(this.className)};Element.prototype.addClassName=function(b){if(!this.hasClassName(b)){this.className=[this.className,b].join(" ")}};Element.prototype.removeClassName=function(c){if(this.hasClassName(c)){var d=this.className;this.className=d.replace(new RegExp("(?:^|\\s+)"+c+"(?:\\s+|$)","g")," ")}};Element.prototype.toggleClassName=function(b){this[this.hasClassName(b)?"removeClassName":"addClassName"](b)};function checkhHtml5(){try{document.createElement("canvas").getContext("2d");return true}catch(a){return false}}function Ajax(){this.getHttpRequest=function(){var a=false;if(window.XMLHttpRequest){a=new XMLHttpRequest();if(a.overrideMimeType){a.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}}}if(!a){window.alert("Can not create ths instance of XMLHttpRequest");return false}return a}}Ajax.prototype.getResponse=function(){var b=arguments[0];var c=arguments[1];var d=arguments[2];var a=this.getHttpRequest();a.open("GET",b,true);a.send(d);a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200||a.status==0){c(a.responseText)}else{alert("ERROR "+a.status+"!\nLoad File Failed.")}}}};function Calendar(a,b){this.dateEx=new DateEx(a,b,0);this.header=new CalendarHeader(this);this.body=new CalendarBody(this);this.list=new EventList(this);this.onDateChange=null;this.onMonthChange=null;this.renderInto=function(e){var d=$(e);var c=d.createChild("div",{"class":"calendar"});if(this.dateEx.month<=0||this.dateEx.month>=12){c.innerHTML="Invalid Month";return}this.header.renderInto(c);this.body.renderInto(c);this.list.renderInto(c);if(typeof this.onMonthChange=="function"){this.onMonthChange()}};this.previousMonth=function(){if(this.dateEx.month==1){this.dateEx.month=12;this.dateEx.year--}else{this.dateEx.month--}this.header.refresh();this.body.refresh();if(typeof this.onMonthChange=="function"){this.onMonthChange()}};this.nextMonth=function(){if(this.dateEx.month==12){this.dateEx.month=1;this.dateEx.year++}else{this.dateEx.month++}this.header.refresh();this.body.refresh();if(typeof this.onMonthChange=="function"){this.onMonthChange()}};this.previousYear=function(){this.dateEx.year--;this.header.refresh();this.body.refresh();if(typeof this.onMonthChange=="function"){this.onMonthChange()}};this.nextYear=function(){this.dateEx.year++;this.header.refresh();this.body.refresh();if(typeof this.onMonthChange=="function"){this.onMonthChange()}};this.selectDate=function(c){this.dateEx.date=c;if(typeof this.onDateChange=="function"){this.onDateChange()}};this.unselectDate=function(){this.dateEx.date=0;this.body.unselectTD();if(typeof this.onDateChange=="function"){this.onDateChange()}};this.getMonthName=function(){return Consts.MonthNames[this.dateEx.month-1]};this.getDaysCount=function(){if(this.dateEx.month!=2){return Consts.TotalDays[this.dateEx.month-1]}else{if((this.dateEx.year%100!=0)&&(this.dateEx.year%4==0)||(this.dateEx.year%400==0)){return 29}else{return 28}}};this.showList=function(c){this.body.setShowing(!c);this.list.setShowing(c)};this.setMonthlyData=function(c){this.body.setMonthlyData(c)};this.getMonthlyData=function(){return this.body.getMonthlyData()};this.setDailyData=function(c){this.list.setDailyData(c)}}var Consts={MonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],TotalDays:[31,-1,31,30,31,30,31,31,30,31,30,31],DayNames:["SUN","MON","TUE","WED","THU","FRI","SAT"],LoneDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Colors:["ff3300","00ff00","0099cc","FA8072","6A5ACD","ffA500"],getColor:function(a){return Consts.Colors[a%Consts.Colors.length]}};function DateEx(b,c,a){this.year=b;this.month=c;this.date=a;this.getYMString=function(){return this.year+"-"+this.month};this.getYMDString=function(){return this.getYMString()+"-"+this.date};this.getMonthName=function(){return Consts.MonthNames[this.month-1]};this.getDateString=function(){return this.getMonthName()+" "+this.date+", "+this.year};this.getMonthString=function(){return this.getMonthName()+", "+this.year};this.getDay=function(){var e=new Date();e.setFullYear(this.year,this.month-1,this.date);return e.getDay()};this.getLoneDayName=function(){return Consts.LoneDayNames[this.getDay()]}}DateEx.today=function(){var a=new Date();return new DateEx(a.getFullYear(),a.getMonth()+1,a.getDate())};function CalendarHeader(a){this.calendar=a;this.monthLabel=null;this.yearLabel=null;this.renderInto=function(c){var o=this;var b=c.createChild("div",{"class":"header"});var q=b.createChild("table",{style:"float: left"});var l=q.createChild("tr");var h=l.createChild("td");var g=l.createChild("td");var f=l.createChild("td");var p=b.createChild("table",{style:"float: right"});var j=p.createChild("tr");var n=j.createChild("td");var m=j.createChild("td");var k=j.createChild("td");var e=new ArrowButton(h,"left",function(){o.calendar.previousMonth()});this.monthLabel=g.createChild("div",{},this.calendar.getMonthName());var i=new ArrowButton(f,"right",function(){o.calendar.nextMonth()});var r=new ArrowButton(n,"left",function(){o.calendar.previousYear()});this.yearLabel=m.createChild("div",{},this.calendar.dateEx.year);var d=new ArrowButton(k,"right",function(){o.calendar.nextYear()})};this.refresh=function(){this.monthLabel.innerHTML=this.calendar.getMonthName();this.yearLabel.innerHTML=this.calendar.dateEx.year}}function ArrowButton(a,b,c){this.renderInto=function(d){var f=this;var e=d.createChild("div",{"class":"arrow "+b});d.onmouseover=function(){e.addClassName(b+"Hover")};d.onmouseout=function(){e.removeClassName(b+"Hover")};d.onclick=function(){if(typeof c=="function"){c()}e.removeClassName(b+"Hover")}};this.renderInto(a)}function CalendarBody(a){this.calendar=a;this.table=null;this.eventContainers=null;this.selectedTD=null;this.monthlyData=[];this.renderInto=function(b){this.table=b.createChild("table",{"class":"monthTable"});this.renderDays(this.table);this.renderDates(this.table)};this.setShowing=function(b){if(b){this.table.removeClassName("hidden")}else{this.table.addClassName("hidden")}};this.refresh=function(){while(this.table.childNodes.length>1){this.table.removeChild(this.table.childNodes[1])}this.renderDates(this.table)};this.renderDays=function(c){var d=c.createChild("tr");for(var b=0;b<=6;b++){var e=d.createChild("th",{"class":(b==0||b==6)?"weekend":"workday"});e.innerHTML=Consts.DayNames[b]}};this.renderDates=function(s){var m=this;this.selectedTD=null;var d=new Date();var e=d.getMonth();var p=d.getDate();var r=d.getFullYear();var o=s.createChild("tr");var b=new Date();b.setFullYear(this.calendar.dateEx.year,this.calendar.dateEx.month-1,1);var l=b.getDay();for(var k=0;k<l;k++){var j=o.createChild("td",{"class":"previousMonth"});var c=j.createChild("div",{"class":"dateContainer"})}var h=l;this.eventContainers=[];for(var k=0;k<this.calendar.getDaysCount();k++){var g=k+1;var n="";if(this.calendar.dateEx.year==r&&this.calendar.dateEx.month==(e+1)&&(k+1)==p){n="today"}else{if(h==0||h==6){n="weekend"}else{n="workday"}}var j=o.createChild("td",{"class":n});j.setAttribute("data-date",g);var c=j.createChild("div",{"class":"dateContainer"});var f=c.createChild("div",{"class":"date-label"},g);var q=c.createChild("div",{"class":"event-container"});q.setAttribute("data-eventsCount",0);q.setAttribute("data-eventsColor",0);this.eventContainers.push(q);j.onmouseover=function(){this.addClassName("hover")};j.onmouseout=function(){this.removeClassName("hover")};j.onclick=function(){if(m.selectedTD!=null){m.selectedTD.removeClassName("selected")}m.selectedTD=this;this.addClassName("selected");var i=this.attributes["data-date"].value;m.calendar.selectDate(i)};if(h==6){o=s.createChild("tr");h=0}else{h++}}if(h!=0){for(var k=0;k<7-h;k++){var j=o.createChild("td",{"class":"nextMonth"});var c=j.createChild("div",{"class":"dateContainer"})}}};this.unselectTD=function(){if(this.selectedTD!=null){this.selectedTD.removeClassName("selected")}};this.setMonthlyData=function(g){this.monthlyData=g;for(var c=0;c<g.length;c++){var e=g[c];var f=this.eventContainers[e.date-1];var d=f.attributes["data-eventsCount"].value;d++;f.setAttribute("data-eventsCount",d);f.setAttribute("data-eventsColor",e.color)}for(var c=0;c<this.eventContainers.length;c++){var f=this.eventContainers[c];var d=f.attributes["data-eventsCount"].value;if(d>0){var b=f.attributes["data-eventsColor"].value;f.createChild("div",{"class":"pushpin",style:"background-color: #"+Consts.getColor(b)},d>1?d:"")}}};this.getMonthlyData=function(){return this.monthlyData}}function EventList(a){this.calendar=a;this.domObj=null;this.itemContainer=null;this.dateLabel=null;this.dayLabel=null;this.renderInto=function(d){var e=this;var c=$(d);this.domObj=c.createChild("div",{"class":"list"});var b=this.domObj.createChild("div",{"class":"body"});var g=b.createChild("div",{"class":"list-background"});this.dateLabel=g.createChild("div",{"class":"date"});this.dayLabel=g.createChild("div",{"class":"day"});var f=b.createChild("div",{"class":"list-container"});this.itemContainer=f.createChild("div",{"class":"item-container"});var h=this.domObj.createChild("div",{"class":"toolbar-footer"});var i=h.createChild("div",{"class":"add-button",},"Add +");i.onclick=function(){var k=new EventData();k.year=e.calendar.dateEx.year;k.month=e.calendar.dateEx.month;k.date=e.calendar.dateEx.date;k.color=0;var l=new EventRow(k);l.renderInto(e.itemContainer)};var j=h.createChild("div",{"class":"back-button"},"&lt; back");j.onclick=function(){e.calendar.unselectDate()}};this.setShowing=function(b){if(b){this.domObj.removeClassName("hidden");this.dateLabel.innerHTML=this.calendar.dateEx.date;this.dayLabel.innerHTML=this.calendar.dateEx.getLoneDayName()}else{this.domObj.addClassName("hidden")}};this.setDailyData=function(e){while(this.itemContainer.childNodes.length>0){this.itemContainer.removeChild(this.itemContainer.childNodes[0])}if(e.length==0){this.itemContainer.createChild("div",{"class":"item-line no-item"},"[No Events]")}else{for(var c=0;c<e.length;c++){var b=e[c];var d=new EventRow(b);d.renderInto(this.itemContainer)}}}}function EventRow(a){this.data=a;this.newColor=a.color;this.wrapper=null;this.tableDisplay=null;this.tableEdit=null;this.tdDisplayText=null;this.tdEditColor=null;this.objColor=null;this.objText=null;this.objColorSelect=null}EventRow.prototype.renderInto=function(m){var l=this;this.wrapper=m.createChild("div",{"class":"item-line"});this.tableDisplay=this.wrapper.createChild("table");var b=this.tableDisplay.createChild("tr");this.tdDisplayPushpin=b.createChild("td",{"class":"display-color"});this.tdDisplayText=b.createChild("td",{"class":"display-text"});var o=b.createChild("td",{"class":"display-tool"});var k=o.createChild("div",{"class":"edit",title:"edit"});k.onclick=function(){l.beginEdit()};var e=o.createChild("div",{"class":"delete",title:"delete"});e.onclick=function(){if(window.confirm("Sure to delete?")){l.wrapper.parentNode.removeChild(l.wrapper)}};this.tableEdit=this.wrapper.createChild("table");var n=this.tableEdit.createChild("tr");var d=n.createChild("td",{"class":"edit-color"});var a=n.createChild("td",{"class":"edit-text"});var c=n.createChild("td",{"class":"edit-tool"});this.objColor=d.createChild("div",{"class":"color-select"});this.objColorSelect=d.createChild("div",{"class":"color-option-container hidden"});for(var h=0;h<Consts.Colors.length;h++){var j=this.objColorSelect.createChild("div",{"class":"color-option-item",style:"background-color: #"+Consts.getColor(h)});j.setAttribute("data-color",h);j.onclick=function(){var q=this.parentNode;for(var p=0;p<q.childNodes.length;p++){q.childNodes[p].removeClassName("color-option-selected")}this.addClassName("color-option-selected");q.addClassName("hidden");l.newColor=this.attributes["data-color"].value;l.objColor.setAttribute("style","background-color: #"+Consts.getColor(l.newColor))}}this.objColor.onclick=function(){l.objColorSelect.toggleClassName("hidden")};this.objText=a.createChild("input",{type:"text","class":"input"});var f=c.createChild("div",{"class":"check",title:"save"});f.onclick=function(){l.data.color=l.newColor;l.data.text=l.objText.value;l.endEdit()};var g=c.createChild("div",{"class":"back",title:"back"});g.onclick=function(){if(!l.data.hasText()){l.wrapper.parentNode.removeChild(l.wrapper)}else{l.endEdit()}};if(!this.data.hasText()){this.beginEdit()}else{this.endEdit()}};EventRow.prototype.updateData=function(){this.tdDisplayPushpin.setAttribute("style","background-color: #"+this.data.getColorCode());this.tdDisplayText.innerHTML=this.data.text;this.objColor.setAttribute("style","background-color: #"+this.data.getColorCode());this.objText.value=this.data.text;var b=this.objColorSelect;for(var a=0;a<b.childNodes.length;a++){var c=b.childNodes[a];if(a==this.data.color){c.addClassName("color-option-selected")}else{c.removeClassName("color-option-selected")}}};EventRow.prototype.beginEdit=function(){this.tableDisplay.addClassName("hidden");this.tableEdit.removeClassName("hidden");this.updateData()};EventRow.prototype.endEdit=function(){this.tableDisplay.removeClassName("hidden");this.tableEdit.addClassName("hidden");if(!this.objColorSelect.hasClassName("hidden")){this.objColorSelect.addClassName("hidden")}this.updateData()};function EventData(){this.year=null;this.month=null;this.date=null;this.color=null;this.text=null;this.recurrence=null}EventData.prototype.toArray=function(){var a=new Array(this.year,this.month,this.date,this.color,this.text,this.recurrence);return a};EventData.prototype.fromArray=function(a){this.year=a[0];this.month=a[1];this.date=a[2];this.color=a[3];this.text=a[4];this.recurrence=a[5]};EventData.prototype.getColorCode=function(){return Consts.getColor(this.color)};EventData.prototype.hasText=function(){return this.text!=null};var Recurrences={None:"N",Weekly:"W",Monthly:"W",Yearly:"Y"};var dataArray=null;function downloadData(){}var init=function(){if(!checkhHtml5()){document.write("Your browser doesn't support HTML5");return}renderToolbar();var b=(new Date()).valueOf();var a=new Ajax();a.getResponse("dummy_data.json?ts="+b,onDataDownloaded,null)};function onDataDownloaded(b){var d=JSON.parse(b);var e=d.events;var a=[];for(var f=0;f<e.length;f++){var g=new EventData();g.fromArray(e[f]);a.push(g)}var c=DateEx.today();var h=new Calendar(c.year,c.month);h.onDateChange=function(){if(h.dateEx.date==0){this.showList(false)}else{this.showList(true);var l=this.getMonthlyData();var m=[];for(var j=0;j<l.length;j++){var k=l[j];if(k.date==h.dateEx.date){m.push(k)}}this.setDailyData(m)}};h.onMonthChange=function(){this.showList(false);var l=[];for(var j=0;j<a.length;j++){var k=a[j];if(k.year==h.dateEx.year&&k.month==h.dateEx.month){l.push(k)}}this.setMonthlyData(l)};h.renderInto("calendarContainer")}function renderToolbar(){var a=$("toolbar");a.createChild("div",null,"Switch to Dec, 2013 to view the sample data.")}function updateAppCache(){console.log("Updateing application cache...");var a=window.applicationCache;a.update()}window.applicationCache.addEventListener("updateready",function(a){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){window.applicationCache.swapCache();if(confirm("A new version of this site is available.Load it ? ")){window.location.reload()}}else{}},false);if(window.addEventListener){window.addEventListener("load",init,false)}else{if(window.attachEvent){window.attachEvent("onload",init)}}document.onselectstart=function(){return(false)};